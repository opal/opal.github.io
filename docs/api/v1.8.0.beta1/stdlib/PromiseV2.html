<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: PromiseV2
  
    &mdash; stdlib (Opal v1.8.0.beta1)
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "PromiseV2";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  <span class="title"><a href="/docs">Opal Docs</a></span>
  
    &raquo;
    <a href="_index.html">Index (P)</a> &raquo;
    
    
    <span class="title">PromiseV2</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: PromiseV2
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">PromiseV2</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>opal/stdlib/promise/v2.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p><span class='object_link'><a href="Promise.html" title="Promise (class)">Promise</a></span> is used to help structure asynchronous code.</p>

<p>It is available in the Opal standard library, and can be required in any Opal
application:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>promise/v2</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<h2 id="basic-usage">Basic Usage</h2>

<p>Promises are created and returned as objects with the assumption that they
will eventually be resolved or rejected, but never both. A <span class='object_link'><a href="Promise.html" title="Promise (class)">Promise</a></span> has
a <span class='object_link'><a href="#then-instance_method" title="PromiseV2#then (method)">#then</a></span> and <span class='object_link'><a href="#fail-instance_method" title="PromiseV2#fail (method)">#fail</a></span> method (or one of their aliases) that can be used to
register a block that gets called once resolved or rejected.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_promise'>promise</span> <span class='op'>=</span> <span class='const'>PromiseV2</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="PromiseV2#initialize (method)">new</a></span></span>

<span class='id identifier rubyid_promise'>promise</span><span class='period'>.</span><span class='id identifier rubyid_then'>then</span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resolved!</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_fail'>fail</span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rejected!</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>

<span class='comment'># some time later
</span><span class='id identifier rubyid_promise'>promise</span><span class='period'>.</span><span class='id identifier rubyid_resolve'>resolve</span>

<span class='comment'># =&gt; &quot;resolved!&quot;
</span></code></pre>

<p>It is important to remember that a promise can only be resolved or rejected
once, so the block will only ever be called once (or not at all).</p>

<h2 id="resolving-promises">Resolving Promises</h2>

<p>To resolve a promise, means to inform the <span class='object_link'><a href="Promise.html" title="Promise (class)">Promise</a></span> that it has succeeded
or evaluated to a useful value. <span class='object_link'><a href="#resolve-instance_method" title="PromiseV2#resolve (method)">#resolve</a></span> can be passed a value which is
then passed into the block handler:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_get_json'>get_json</span>
  <span class='id identifier rubyid_promise'>promise</span> <span class='op'>=</span> <span class='const'>PromiseV2</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="PromiseV2#initialize (method)">new</a></span></span>

  <span class='const'>HTTP</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>some_url</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_req'>req</span><span class='op'>|</span>
    <span class='id identifier rubyid_promise'>promise</span><span class='period'>.</span><span class='id identifier rubyid_resolve'>resolve</span> <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_promise'>promise</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get_json'>get_json</span><span class='period'>.</span><span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_json'>json</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>got some JSON from server</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<h2 id="rejecting-promises">Rejecting Promises</h2>

<p>Promises are also designed to handle error cases, or situations where an
outcome is not as expected. Taking the previous example, we can also pass
a value to a <span class='object_link'><a href="#reject-instance_method" title="PromiseV2#reject (method)">#reject</a></span> call, which passes that object to the registered
<span class='object_link'><a href="#fail-instance_method" title="PromiseV2#fail (method)">#fail</a></span> handler:</p>

<pre class="code ruby"><code class="ruby">def get_json
  promise = PromiseV2.new

  HTTP.get(&quot;some_url&quot;) do |req|
    if req.ok?
      promise.resolve req.json
    else
      promise.reject req
    end

  promise
end

get_json.then {
  # ...
}.fail { |req|
  puts &quot;it went wrong: #{req.message}&quot;
}
</code></pre>

<h2 id="chaining-promises">Chaining Promises</h2>

<p>Promises become even more useful when chained together. Each <span class='object_link'><a href="#then-instance_method" title="PromiseV2#then (method)">#then</a></span> or
<span class='object_link'><a href="#fail-instance_method" title="PromiseV2#fail (method)">#fail</a></span> call returns a new <span class='object_link'><a href="" title="PromiseV2 (class)">PromiseV2</a></span> which can be used to chain more and more
handlers together.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_promise'>promise</span><span class='period'>.</span><span class='id identifier rubyid_then'>then</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_wait_for_something'>wait_for_something</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_then'>then</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_do_something_else'>do_something_else</span> <span class='rbrace'>}</span>
</code></pre>

<p>Rejections are propagated through the entire chain, so a &quot;catch all&quot; handler
can be attached at the end of the tail:</p>

<pre class="code ruby"><code class="ruby">promise.then { ... }.then { ... }.fail { ... }
</code></pre>

<h2 id="composing-promises">Composing Promises</h2>

<p><span class='object_link'><a href="#when-class_method" title="PromiseV2.when (method)">PromiseV2.when</a></span> can be used to wait for more than one promise to resolve (or
reject). Using the previous example, we could request two different json
requests and wait for both to finish:</p>

<pre class="code ruby"><code class="ruby">PromiseV2.when(get_json, get_json2).then |first, second|
  puts &quot;got two json payloads: #{first}, #{second}&quot;
end
</code></pre>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#next-instance_method" title="#next (instance method)">#<strong>next</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute next.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#prev-instance_method" title="#prev (instance method)">#<strong>prev</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute prev.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#all_resolved-class_method" title="all_resolved (class method)">.<strong>all_resolved</strong>(*promises)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#allocate-class_method" title="allocate (class method)">.<strong>allocate</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#any-class_method" title="any (class method)">.<strong>any</strong>(*promises)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#error-class_method" title="error (class method)">.<strong>error</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#race-class_method" title="race (class method)">.<strong>race</strong>(*promises)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reject-class_method" title="reject (class method)">.<strong>reject</strong>(value = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resolve-class_method" title="resolve (class method)">.<strong>resolve</strong>(value = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#value-class_method" title="value (class method)">.<strong>value</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#when-class_method" title="when (class method)">.<strong>when</strong>(*promises)  &#x21d2; Object </a>
    

    
      (also: all)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#always-instance_method" title="#always (instance method)">#<strong>always</strong>(&amp;block)  &#x21d2; Object </a>
    

    
      (also: #ensure, #finally)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#always!-instance_method" title="#always! (instance method)">#<strong>always!</strong>(&amp;block)  &#x21d2; Object </a>
    

    
      (also: #ensure!, #finally!)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#and-instance_method" title="#and (instance method)">#<strong>and</strong>(*promises)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#error-instance_method" title="#error (instance method)">#<strong>error</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fail-instance_method" title="#fail (instance method)">#<strong>fail</strong>(&amp;block)  &#x21d2; Object </a>
    

    
      (also: #catch, #rescue)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fail!-instance_method" title="#fail! (instance method)">#<strong>fail!</strong>(&amp;block)  &#x21d2; Object </a>
    

    
      (also: #catch!, #rescue!)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#gen_tracing_proc-instance_method" title="#gen_tracing_proc (instance method)">#<strong>gen_tracing_proc</strong>(passing, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong> {|_self| ... } &#x21d2; PromiseV2 </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of PromiseV2.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#light_nativity_check!-instance_method" title="#light_nativity_check! (instance method)">#<strong>light_nativity_check!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Raise an exception when a non-JS-native method is called on a JS-native promise but permits some typed promises.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#native%3F-instance_method" title="#native? (instance method)">#<strong>native?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Is this promise native to JavaScript? This means, that methods like resolve or reject won&#39;t be available.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#nativity_check!-instance_method" title="#nativity_check! (instance method)">#<strong>nativity_check!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Raise an exception when a non-JS-native method is called on a JS-native promise.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#realized%3F-instance_method" title="#realized? (instance method)">#<strong>realized?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reject-instance_method" title="#reject (instance method)">#<strong>reject</strong>(value = nil)  &#x21d2; Object </a>
    

    
      (also: #reject!)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rejected%3F-instance_method" title="#rejected? (instance method)">#<strong>rejected?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resolve-instance_method" title="#resolve (instance method)">#<strong>resolve</strong>(value = nil)  &#x21d2; Object </a>
    

    
      (also: #resolve!)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resolved%3F-instance_method" title="#resolved? (instance method)">#<strong>resolved?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#then-instance_method" title="#then (instance method)">#<strong>then</strong>(&amp;block)  &#x21d2; Object </a>
    

    
      (also: #do)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#then!-instance_method" title="#then! (instance method)">#<strong>then!</strong>(&amp;block)  &#x21d2; Object </a>
    

    
      (also: #do!)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#there_can_be_only_one!-instance_method" title="#there_can_be_only_one! (instance method)">#<strong>there_can_be_only_one!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Allow only one chain to be present, as needed by the previous implementation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_v1-instance_method" title="#to_v1 (instance method)">#<strong>to_v1</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#trace-instance_method" title="#trace (instance method)">#<strong>trace</strong>(depth = nil, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#trace!-instance_method" title="#trace! (instance method)">#<strong>trace!</strong>(*args, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#value-instance_method" title="#value (instance method)">#<strong>value</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong> {|_self| ... } &#x21d2; <tt><span class='object_link'><a href="" title="PromiseV2 (class)">PromiseV2</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new instance of PromiseV2.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>_self</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>_self</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="PromiseV2 (class)">PromiseV2</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the object that the method was called on</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


344
345
346</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 344</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>yield</span> <span class='kw'>self</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="next-instance_method">
  
    #<strong>next</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute next.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


166
167
168</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 166</span>

<span class='kw'>def</span> <span class='kw'>next</span>
  <span class='ivar'>@next</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="prev-instance_method">
  
    #<strong>prev</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute prev.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


166
167
168</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 166</span>

<span class='kw'>def</span> <span class='id identifier rubyid_prev'>prev</span>
  <span class='ivar'>@prev</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="all_resolved-class_method">
  
    .<strong>all_resolved</strong>(*promises)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


122
123
124
125
126
127</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 122</span>

<span class='kw'>def</span> <span class='id identifier rubyid_all_resolved'>all_resolved</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_promises'>promises</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_promises'>promises</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>?</span> <span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>:</span> <span class='id identifier rubyid_promises'>promises</span><span class='rparen'>)</span>
  <span class='backtick'>`</span><span class='tstring_content'>Promise.allResolved(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_promises'>promises</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_prom'>prom</span><span class='op'>|</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:all_resolved</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="allocate-class_method">
  
    .<strong>allocate</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


105
106
107
108
109
110
111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 105</span>

<span class='kw'>def</span> <span class='id identifier rubyid_allocate'>allocate</span>
  <span class='id identifier rubyid_ok'>ok</span><span class='comma'>,</span> <span class='id identifier rubyid_fail'>fail</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span>

  <span class='id identifier rubyid_prom'>prom</span> <span class='op'>=</span> <span class='backtick'>`</span><span class='tstring_content'>new self.$$constructor(function(_ok, _fail) { </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ok'>ok</span><span class='embexpr_end'>}</span><span class='tstring_content'> = _ok; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_fail'>fail</span><span class='embexpr_end'>}</span><span class='tstring_content'> = _fail; })</span><span class='tstring_end'>`</span></span>
  <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:opal</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@resolve_proc</span><span class='comma'>,</span> <span class='id identifier rubyid_ok'>ok</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@reject_proc</span><span class='comma'>,</span> <span class='id identifier rubyid_fail'>fail</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prom'>prom</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="any-class_method">
  
    .<strong>any</strong>(*promises)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 129</span>

<span class='kw'>def</span> <span class='id identifier rubyid_any'>any</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_promises'>promises</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_promises'>promises</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>?</span> <span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>:</span> <span class='id identifier rubyid_promises'>promises</span><span class='rparen'>)</span>
  <span class='backtick'>`</span><span class='tstring_content'>Promise.any(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_promises'>promises</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_prom'>prom</span><span class='op'>|</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:any</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="error-class_method">
  
    .<strong>error</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


162
163
164
165
166
167
168
169</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 162</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reject'>reject</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='backtick'>`</span><span class='tstring_content'>Promise.reject(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_prom'>prom</span><span class='op'>|</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:reject</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@realized</span><span class='comma'>,</span> <span class='symbol'>:reject</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value_set</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="race-class_method">
  
    .<strong>race</strong>(*promises)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


136
137
138
139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 136</span>

<span class='kw'>def</span> <span class='id identifier rubyid_race'>race</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_promises'>promises</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_promises'>promises</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>?</span> <span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>:</span> <span class='id identifier rubyid_promises'>promises</span><span class='rparen'>)</span>
  <span class='backtick'>`</span><span class='tstring_content'>Promise.race(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_promises'>promises</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_prom'>prom</span><span class='op'>|</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:race</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reject-class_method">
  
    .<strong>reject</strong>(value = nil)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


152
153
154
155
156
157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 152</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reject'>reject</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='backtick'>`</span><span class='tstring_content'>Promise.reject(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_prom'>prom</span><span class='op'>|</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:reject</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@realized</span><span class='comma'>,</span> <span class='symbol'>:reject</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value_set</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resolve-class_method">
  
    .<strong>resolve</strong>(value = nil)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146
147
148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 143</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resolve'>resolve</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='backtick'>`</span><span class='tstring_content'>Promise.resolve(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_prom'>prom</span><span class='op'>|</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:resolve</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@realized</span><span class='comma'>,</span> <span class='symbol'>:resolve</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value_set</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="value-class_method">
  
    .<strong>value</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


163
164
165
166
167
168
169
170</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 163</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resolve'>resolve</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='backtick'>`</span><span class='tstring_content'>Promise.resolve(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_prom'>prom</span><span class='op'>|</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:resolve</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@realized</span><span class='comma'>,</span> <span class='symbol'>:resolve</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value_set</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="when-class_method">
  
    .<strong>when</strong>(*promises)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='all-class_method'>all</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118
119
120</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 115</span>

<span class='kw'>def</span> <span class='kw'>when</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_promises'>promises</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_promises'>promises</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>?</span> <span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>:</span> <span class='id identifier rubyid_promises'>promises</span><span class='rparen'>)</span>
  <span class='backtick'>`</span><span class='tstring_content'>Promise.all(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_promises'>promises</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_prom'>prom</span><span class='op'>|</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:when</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="always-instance_method">
  
    #<strong>always</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='ensure-instance_method'>ensure</span>, <span id='finally-instance_method'>finally</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


259
260
261
262
263
264
265
266
267
268
269
270
271</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 259</span>

<span class='kw'>def</span> <span class='id identifier rubyid_always'>always</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prom'>prom</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_blk'>blk</span> <span class='op'>=</span> <span class='id identifier rubyid_gen_tracing_proc'>gen_tracing_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@realized</span><span class='comma'>,</span> <span class='symbol'>:resolve</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value_set</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_prom'>prom</span> <span class='op'>=</span> <span class='backtick'>`</span><span class='tstring_content'>self.finally(function() { return blk(self.$value_internal()); })</span><span class='tstring_end'>`</span></span>
  <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@prev</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:always</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='ivar'>@next</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_prom'>prom</span>
  <span class='id identifier rubyid_prom'>prom</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="always!-instance_method">
  
    #<strong>always!</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='ensure!-instance_method'>ensure!</span>, <span id='finally!-instance_method'>finally!</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


273
274
275
276</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 273</span>

<span class='kw'>def</span> <span class='id identifier rubyid_always!'>always!</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_there_can_be_only_one!'>there_can_be_only_one!</span>
  <span class='id identifier rubyid_always'>always</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="and-instance_method">
  
    #<strong>and</strong>(*promises)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


331
332
333
334
335
336
337
338
339
340
341
342</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 331</span>

<span class='kw'>def</span> <span class='kw'>and</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_promises'>promises</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_promises'>promises</span> <span class='op'>=</span> <span class='id identifier rubyid_promises'>promises</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="" title="PromiseV2 (class)">PromiseV2</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_i'>i</span>
      <span class='id identifier rubyid_i'>i</span>
    <span class='kw'>else</span>
      <span class='const'><span class='object_link'><a href="" title="PromiseV2 (class)">PromiseV2</a></span></span><span class='period'>.</span><span class='id identifier rubyid_value'><span class='object_link'><a href="#value-class_method" title="PromiseV2.value (method)">value</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='const'><span class='object_link'><a href="" title="PromiseV2 (class)">PromiseV2</a></span></span><span class='period'>.</span><span class='id identifier rubyid_when'><span class='object_link'><a href="#when-class_method" title="PromiseV2.when (method)">when</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_promises'>promises</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span>
    <span class='lbracket'>[</span><span class='op'>*</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_b'>b</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="error-instance_method">
  
    #<strong>error</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


326
327
328
329</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 326</span>

<span class='kw'>def</span> <span class='id identifier rubyid_error'>error</span>
  <span class='id identifier rubyid_light_nativity_check!'>light_nativity_check!</span>
  <span class='ivar'>@value</span> <span class='kw'>if</span> <span class='id identifier rubyid_rejected?'>rejected?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fail-instance_method">
  
    #<strong>fail</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='catch-instance_method'>catch</span>, <span id='rescue-instance_method'>rescue</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


240
241
242
243
244
245
246
247
248
249
250
251
252</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 240</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prom'>prom</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_blk'>blk</span> <span class='op'>=</span> <span class='id identifier rubyid_gen_tracing_proc'>gen_tracing_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@realized</span><span class='comma'>,</span> <span class='symbol'>:resolve</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value_set</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_prom'>prom</span> <span class='op'>=</span> <span class='backtick'>`</span><span class='tstring_content'>self.catch(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_blk'>blk</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>`</span></span>
  <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@prev</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:fail</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='ivar'>@next</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_prom'>prom</span>
  <span class='id identifier rubyid_prom'>prom</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fail!-instance_method">
  
    #<strong>fail!</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='catch!-instance_method'>catch!</span>, <span id='rescue!-instance_method'>rescue!</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


254
255
256
257</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 254</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fail!'>fail!</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_there_can_be_only_one!'>there_can_be_only_one!</span>
  <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="gen_tracing_proc-instance_method">
  
    #<strong>gen_tracing_proc</strong>(passing, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


193
194
195
196
197
198
199</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 193</span>

<span class='kw'>def</span> <span class='id identifier rubyid_gen_tracing_proc'>gen_tracing_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_passing'>passing</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_passing'>passing</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span>
    <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_res'>res</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_res'>res</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    #<strong>inspect</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 356</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='kw'>if</span> <span class='ivar'>@type</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@type</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='qsymbols_beg'>%i[</span><span class='tstring_content'>opal</span><span class='words_sep'> </span><span class='tstring_content'>resolve</span><span class='words_sep'> </span><span class='tstring_content'>reject</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='ivar'>@type</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>:native</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@realized</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@realized</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>

  <span class='kw'>if</span> <span class='ivar'>@next</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@next</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> &gt;&gt; </span><span class='embexpr_beg'>#{</span><span class='ivar'>@next</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="light_nativity_check!-instance_method">
  
    #<strong>light_nativity_check!</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Raise an exception when a non-JS-native method is called on a JS-native promise
but permits some typed promises</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


181
182
183
184</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 181</span>

<span class='kw'>def</span> <span class='id identifier rubyid_light_nativity_check!'>light_nativity_check!</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='qsymbols_beg'>%i[</span><span class='tstring_content'>reject</span><span class='words_sep'> </span><span class='tstring_content'>resolve</span><span class='words_sep'> </span><span class='tstring_content'>trace</span><span class='words_sep'> </span><span class='tstring_content'>always</span><span class='words_sep'> </span><span class='tstring_content'>fail</span><span class='words_sep'> </span><span class='tstring_content'>then</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='ivar'>@type</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>this promise is native to JavaScript</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_native?'>native?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="native?-instance_method">
  
    #<strong>native?</strong>  &#x21d2; <tt><span class='object_link'><a href="Boolean.html" title="Boolean (class)">Boolean</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Is this promise native to JavaScript? This means, that methods like resolve
or reject won&#39;t be available.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Boolean.html" title="Boolean (class)">Boolean</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


170
171
172</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 170</span>

<span class='kw'>def</span> <span class='id identifier rubyid_native?'>native?</span>
  <span class='ivar'>@type</span> <span class='op'>!=</span> <span class='symbol'>:opal</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="nativity_check!-instance_method">
  
    #<strong>nativity_check!</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Raise an exception when a non-JS-native method is called on a JS-native promise</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 175</span>

<span class='kw'>def</span> <span class='id identifier rubyid_nativity_check!'>nativity_check!</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>this promise is native to JavaScript</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_native?'>native?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="realized?-instance_method">
  
    #<strong>realized?</strong>  &#x21d2; <tt><span class='object_link'><a href="Boolean.html" title="Boolean (class)">Boolean</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Boolean.html" title="Boolean (class)">Boolean</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


315
316
317
318</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 315</span>

<span class='kw'>def</span> <span class='id identifier rubyid_realized?'>realized?</span>
  <span class='id identifier rubyid_light_nativity_check!'>light_nativity_check!</span>
  <span class='op'>!</span><span class='ivar'>@realized</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reject-instance_method">
  
    #<strong>reject</strong>(value = nil)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='reject!-instance_method'>reject!</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


211
212
213
214
215
216
217
218
219</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 211</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reject'>reject</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_nativity_check!'>nativity_check!</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>this promise was already resolved</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='ivar'>@realized</span>
  <span class='ivar'>@value_set</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='ivar'>@realized</span> <span class='op'>=</span> <span class='symbol'>:reject</span>
  <span class='ivar'>@reject_proc</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rejected?-instance_method">
  
    #<strong>rejected?</strong>  &#x21d2; <tt><span class='object_link'><a href="Boolean.html" title="Boolean (class)">Boolean</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Boolean.html" title="Boolean (class)">Boolean</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


310
311
312
313</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 310</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rejected?'>rejected?</span>
  <span class='id identifier rubyid_light_nativity_check!'>light_nativity_check!</span>
  <span class='ivar'>@realized</span> <span class='op'>==</span> <span class='symbol'>:reject</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resolve-instance_method">
  
    #<strong>resolve</strong>(value = nil)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='resolve!-instance_method'>resolve!</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


201
202
203
204
205
206
207
208
209</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 201</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resolve'>resolve</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_nativity_check!'>nativity_check!</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>this promise was already resolved</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='ivar'>@realized</span>
  <span class='ivar'>@value_set</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='ivar'>@realized</span> <span class='op'>=</span> <span class='symbol'>:resolve</span>
  <span class='ivar'>@resolve_proc</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resolved?-instance_method">
  
    #<strong>resolved?</strong>  &#x21d2; <tt><span class='object_link'><a href="Boolean.html" title="Boolean (class)">Boolean</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Boolean.html" title="Boolean (class)">Boolean</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


305
306
307
308</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 305</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resolved?'>resolved?</span>
  <span class='id identifier rubyid_light_nativity_check!'>light_nativity_check!</span>
  <span class='ivar'>@realized</span> <span class='op'>==</span> <span class='symbol'>:resolve</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="then-instance_method">
  
    #<strong>then</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='do-instance_method'>do</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


221
222
223
224
225
226
227
228
229
230
231
232
233</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 221</span>

<span class='kw'>def</span> <span class='kw'>then</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prom'>prom</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_blk'>blk</span> <span class='op'>=</span> <span class='id identifier rubyid_gen_tracing_proc'>gen_tracing_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@realized</span><span class='comma'>,</span> <span class='symbol'>:resolve</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value_set</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@value</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_prom'>prom</span> <span class='op'>=</span> <span class='backtick'>`</span><span class='tstring_content'>self.then(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_blk'>blk</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>`</span></span>
  <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@prev</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:then</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='ivar'>@next</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_prom'>prom</span>
  <span class='id identifier rubyid_prom'>prom</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="then!-instance_method">
  
    #<strong>then!</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='do!-instance_method'>do!</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


235
236
237
238</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 235</span>

<span class='kw'>def</span> <span class='id identifier rubyid_then!'>then!</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_there_can_be_only_one!'>there_can_be_only_one!</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_then'>then</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="there_can_be_only_one!-instance_method">
  
    #<strong>there_can_be_only_one!</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Allow only one chain to be present, as needed by the previous implementation.
This isn&#39;t a strict check - it&#39;s always possible on the JS side to chain a
given block.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


189
190
191</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 189</span>

<span class='kw'>def</span> <span class='id identifier rubyid_there_can_be_only_one!'>there_can_be_only_one!</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a promise has already been chained</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='ivar'>@next</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@next</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_v1-instance_method">
  
    #<strong>to_v1</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


348
349
350
351
352
353
354</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 348</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_v1'>to_v1</span>
  <span class='id identifier rubyid_v1'>v1</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="top-level-namespace.html#PromiseV1-constant" title="PromiseV1 (constant)">PromiseV1</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_then'>then</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_v1'>v1</span><span class='period'>.</span><span class='id identifier rubyid_resolve'>resolve</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_rescue'>rescue</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_v1'>v1</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_v1'>v1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="trace-instance_method">
  
    #<strong>trace</strong>(depth = nil, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 278</span>

<span class='kw'>def</span> <span class='id identifier rubyid_trace'>trace</span><span class='lparen'>(</span><span class='id identifier rubyid_depth'>depth</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prom'>prom</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_prom'>prom</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_prom'>prom</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_depth'>depth</span> <span class='op'>||</span> <span class='id identifier rubyid_depth'>depth</span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
      <span class='kw'>rescue</span> <span class='const'>ArgumentError</span>
        <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='symbol'>:native</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_depth'>depth</span> <span class='op'>-=</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_depth'>depth</span>
      <span class='id identifier rubyid_prom'>prom</span> <span class='op'>=</span> <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_prev'>prev</span>
    <span class='kw'>end</span>
    <span class='kw'>yield</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_prom'>prom</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@type</span><span class='comma'>,</span> <span class='symbol'>:trace</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prom'>prom</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="trace!-instance_method">
  
    #<strong>trace!</strong>(*args, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


300
301
302
303</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 300</span>

<span class='kw'>def</span> <span class='id identifier rubyid_trace!'>trace!</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_there_can_be_only_one!'>there_can_be_only_one!</span>
  <span class='id identifier rubyid_trace'>trace</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="value-instance_method">
  
    #<strong>value</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


320
321
322
323
324</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/promise/v2.rb', line 320</span>

<span class='kw'>def</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_resolved?'>resolved?</span>
    <span class='id identifier rubyid_value_internal'>value_internal</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on 10/12/23 by
  <!-- <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a> -->
  0.9.28 (ruby-2.7.5).
</div>

    </div>
  </body>
</html>