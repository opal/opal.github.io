<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Benchmark
  
    &mdash; stdlib (Opal v0.11.2)
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Benchmark";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  <span class="title"><a href="/docs">Opal Docs</a></span>
  
    &raquo;
    <a href="_index.html">Index (B)</a> &raquo;
    
    
    <span class="title">Benchmark</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Benchmark
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>opal/stdlib/benchmark.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>The Benchmark module provides methods to measure and report the time
used to execute Ruby code.</p>

<ul>
<li><p>Measure the time to construct the string given by the expression
<code>&quot;a&quot;*1_000_000_000</code>:</p>

<p>require &#39;benchmark&#39;</p>

<p>puts Benchmark.measure { &quot;a&quot;*1_000_000_000 }</p></li>
</ul>

<p>On my machine (OSX 10.8.3 on i5 1.7 Ghz) this generates:</p>

<pre class="code ruby"><code class="ruby">  0.350000   0.400000   0.750000 (  0.835234)
</code></pre>

<p>This report shows the user CPU time, system CPU time, the sum of
  the user and system CPU times, and the elapsed real time. The unit
  of time is seconds.</p>

<ul>
<li><p>Do some experiments sequentially using the #bm method:</p>

<p>require &#39;benchmark&#39;</p>

<p>n = 5000000
  Benchmark.bm do |x|
    x.report { for i in 1..n; a = &quot;1&quot;; end }
    x.report { n.times do   ; a = &quot;1&quot;; end }
    x.report { 1.upto(n) do ; a = &quot;1&quot;; end }
  end</p></li>
</ul>

<p>The result:</p>

<pre class="code ruby"><code class="ruby">         user     system      total        real
     1.010000   0.000000   1.010000 (  1.014479)
     1.000000   0.000000   1.000000 (  0.998261)
     0.980000   0.000000   0.980000 (  0.981335)
</code></pre>

<ul>
<li><p>Continuing the previous example, put a label in each report:</p>

<p>require &#39;benchmark&#39;</p>

<p>n = 5000000
  Benchmark.bm(7) do |x|
    x.report(&quot;for:&quot;)   { for i in 1..n; a = &quot;1&quot;; end }
    x.report(&quot;times:&quot;) { n.times do   ; a = &quot;1&quot;; end }
    x.report(&quot;upto:&quot;)  { 1.upto(n) do ; a = &quot;1&quot;; end }
  end</p></li>
</ul>

<p>The result:</p>

<pre class="code ruby"><code class="ruby">                user     system      total        real
  for:      1.010000   0.000000   1.010000 (  1.015688)
  times:    1.000000   0.000000   1.000000 (  1.003611)
  upto:     1.030000   0.000000   1.030000 (  1.028098)
</code></pre>

<ul>
<li><p>The times for some benchmarks depend on the order in which items
are run.  These differences are due to the cost of memory
allocation and garbage collection. To avoid these discrepancies,
the #bmbm method is provided.  For example, to compare ways to
sort an array of floats:</p>

<p>require &#39;benchmark&#39;</p>

<p>array = (1..1000000).map { rand }</p>

<p>Benchmark.bmbm do |x|
    x.report(&quot;sort!&quot;) { array.dup.sort! }
    x.report(&quot;sort&quot;)  { array.dup.sort  }
  end</p></li>
</ul>

<p>The result:</p>

<pre class="code ruby"><code class="ruby">   Rehearsal -----------------------------------------
   sort!   1.490000   0.010000   1.500000 (  1.490520)
   sort    1.460000   0.000000   1.460000 (  1.463025)
   -------------------------------- total: 2.960000sec

               user     system      total        real
   sort!   1.460000   0.000000   1.460000 (  1.460465)
   sort    1.450000   0.010000   1.460000 (  1.448327)
</code></pre>

<ul>
<li><p>Report statistics of sequential experiments with unique labels,
using the #benchmark method:</p>

<p>require &#39;benchmark&#39;
  include Benchmark         # we need the CAPTION and FORMAT constants</p>

<p>n = 5000000
  Benchmark.benchmark(CAPTION, 7, FORMAT, &quot;&gt;total:&quot;, &quot;&gt;avg:&quot;) do |x|
    tf = x.report(&quot;for:&quot;)   { for i in 1..n; a = &quot;1&quot;; end }
    tt = x.report(&quot;times:&quot;) { n.times do   ; a = &quot;1&quot;; end }
    tu = x.report(&quot;upto:&quot;)  { 1.upto(n) do ; a = &quot;1&quot;; end }
    [tf+tt+tu, (tf+tt+tu)/3]
  end</p></li>
</ul>

<p>The result:</p>

<pre class="code ruby"><code class="ruby">                user     system      total        real
   for:      0.950000   0.000000   0.950000 (  0.952039)
   times:    0.980000   0.000000   0.980000 (  0.984938)
   upto:     0.950000   0.000000   0.950000 (  0.946787)
   &gt;total:   2.880000   0.000000   2.880000 (  2.883764)
   &gt;avg:     0.960000   0.000000   0.960000 (  0.961255)
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Benchmark/Job.html" title="Benchmark::Job (class)">Job</a></span>, <span class='object_link'><a href="Benchmark/Report.html" title="Benchmark::Report (class)">Report</a></span>, <span class='object_link'><a href="Benchmark/Tms.html" title="Benchmark::Tms (class)">Tms</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="BENCHMARK_VERSION-constant" class="">BENCHMARK_VERSION =
        <div class="docstring">
  <div class="discussion">
    <p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div>
      </dt>
      <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2002-04-25</span><span class='tstring_end'>&quot;</span></span></pre></dd>
    
      <dt id="CAPTION-constant" class="">CAPTION =
        <div class="docstring">
  <div class="discussion">
    <p>The default caption string (heading above the output times).</p>


  </div>
</div>
<div class="tags">
  

</div>
      </dt>
      <dd><pre class="code"><span class='const'>Benchmark</span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Benchmark/Tms.html" title="Benchmark::Tms (class)">Tms</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Benchmark/Tms.html#CAPTION-constant" title="Benchmark::Tms::CAPTION (constant)">CAPTION</a></span></span></pre></dd>
    
      <dt id="FORMAT-constant" class="">FORMAT =
        <div class="docstring">
  <div class="discussion">
    <p>The default format string used to display times.  See also Benchmark::Tms#format.</p>


  </div>
</div>
<div class="tags">
  

</div>
      </dt>
      <dd><pre class="code"><span class='const'>Benchmark</span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Benchmark/Tms.html" title="Benchmark::Tms (class)">Tms</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Benchmark/Tms.html#FORMAT-constant" title="Benchmark::Tms::FORMAT (constant)">FORMAT</a></span></span></pre></dd>
    
  </dl>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#benchmark-class_method" title="benchmark (class method)">.<strong>benchmark</strong>(caption = &quot;&quot;, label_width = nil, format = nil, *labels)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Invokes the block with a Benchmark::Report object, which may be used to collect and report on the results of individual benchmark tests.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bm-class_method" title="bm (class method)">.<strong>bm</strong>(label_width = 0, *labels, &amp;blk)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A simple interface to the #benchmark method, #bm generates sequential reports with labels.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bmbm-class_method" title="bmbm (class method)">.<strong>bmbm</strong>(width = 0)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Sometimes benchmark results are skewed because code executed earlier encounters different garbage collection overheads than that run later.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#measure-class_method" title="measure (class method)">.<strong>measure</strong>(label = &quot;&quot;)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the time used to execute the given block as a Benchmark::Tms object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#realtime-class_method" title="realtime (class method)">.<strong>realtime</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the elapsed real time used to execute the given block.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="benchmark-class_method">
  
    .<strong>benchmark</strong>(caption = &quot;&quot;, label_width = nil, format = nil, *labels)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Invokes the block with a Benchmark::Report object, which
may be used to collect and report on the results of individual
benchmark tests. Reserves +label_width+ leading spaces for
labels on each line. Prints +caption+ at the top of the
report, and uses +format+ to format each line.
Returns an array of Benchmark::Tms objects.</p>

<p>If the block returns an array of
Benchmark::Tms objects, these will be used to format
additional lines of output. If +label+ parameters are
given, these are used to label these extra lines.</p>

<p><em>Note</em>: Other methods provide a simpler interface to this one, and are
suitable for nearly all benchmarking requirements.  See the examples in
Benchmark, and the #bm and #bmbm methods.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="" title="Benchmark (module)">Benchmark</a></span></span>          <span class='comment'># we need the CAPTION and FORMAT constants
</span>
<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>5000000</span>
<span class='const'><span class='object_link'><a href="" title="Benchmark (module)">Benchmark</a></span></span><span class='period'>.</span><span class='id identifier rubyid_benchmark'>benchmark</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="#CAPTION-constant" title="Benchmark::CAPTION (constant)">CAPTION</a></span></span><span class='comma'>,</span> <span class='int'>7</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#FORMAT-constant" title="Benchmark::FORMAT (constant)">FORMAT</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;total:</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;avg:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_tf'>tf</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>for:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>   <span class='lbrace'>{</span> <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_n'>n</span><span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_tt'>tt</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>times:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_n'>n</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>   <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_tu'>tu</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upto:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='lbrace'>{</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_upto'>upto</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> <span class='rbrace'>}</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_tf'>tf</span><span class='op'>+</span><span class='id identifier rubyid_tt'>tt</span><span class='op'>+</span><span class='id identifier rubyid_tu'>tu</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_tf'>tf</span><span class='op'>+</span><span class='id identifier rubyid_tt'>tt</span><span class='op'>+</span><span class='id identifier rubyid_tu'>tu</span><span class='rparen'>)</span><span class='op'>/</span><span class='int'>3</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</code></pre>

<p>Generates:</p>

<pre class="code ruby"><code class="ruby">                user     system      total        real
  for:      0.970000   0.000000   0.970000 (  0.970493)
  times:    0.990000   0.000000   0.990000 (  0.989542)
  upto:     0.970000   0.000000   0.970000 (  0.972854)
  &gt;total:   2.930000   0.000000   2.930000 (  2.932889)
  &gt;avg:     0.976667   0.000000   0.976667 (  0.977630)
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/benchmark.rb', line 164</span>

<span class='kw'>def</span> <span class='id identifier rubyid_benchmark'>benchmark</span><span class='lparen'>(</span><span class='id identifier rubyid_caption'>caption</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_label_width'>label_width</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_format'>format</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_labels'>labels</span><span class='rparen'>)</span> <span class='comment'># :yield: report
</span>  <span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='const'>STDOUT</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span>
  <span class='const'>STDOUT</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_label_width'>label_width</span> <span class='op'>||=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_label_width'>label_width</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_format'>format</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="#FORMAT-constant" title="Benchmark::FORMAT (constant)">FORMAT</a></span></span>
  <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='op'>*</span><span class='id identifier rubyid_label_width'>label_width</span> <span class='op'>+</span> <span class='id identifier rubyid_caption'>caption</span> <span class='kw'>unless</span> <span class='id identifier rubyid_caption'>caption</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_report'>report</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Benchmark/Report.html" title="Benchmark::Report (class)">Report</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Benchmark/Report.html#initialize-instance_method" title="Benchmark::Report#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_label_width'>label_width</span><span class='comma'>,</span> <span class='id identifier rubyid_format'>format</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_report'>report</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_results'>results</span> <span class='kw'>and</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_grep'>grep</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Benchmark/Tms.html" title="Benchmark::Tms (class)">Tms</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_labels'>labels</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span> <span class='op'>||</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_label'>label</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_ljust'>ljust</span><span class='lparen'>(</span><span class='id identifier rubyid_label_width'>label_width</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span><span class='lparen'>(</span><span class='id identifier rubyid_format'>format</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_report'>report</span><span class='period'>.</span><span class='id identifier rubyid_list'>list</span>
<span class='kw'>ensure</span>
  <span class='const'>STDOUT</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='id identifier rubyid_sync'>sync</span> <span class='kw'>unless</span> <span class='id identifier rubyid_sync'>sync</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="bm-class_method">
  
    .<strong>bm</strong>(label_width = 0, *labels, &amp;blk)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>A simple interface to the #benchmark method, #bm generates sequential
reports with labels.  The parameters have the same meaning as for</p>

<h1>benchmark.</h1>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>5000000</span>
<span class='const'><span class='object_link'><a href="" title="Benchmark (module)">Benchmark</a></span></span><span class='period'>.</span><span class='id identifier rubyid_bm'>bm</span><span class='lparen'>(</span><span class='int'>7</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>for:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>   <span class='lbrace'>{</span> <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_n'>n</span><span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>times:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_n'>n</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>   <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upto:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='lbrace'>{</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_upto'>upto</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>Generates:</p>

<pre class="code ruby"><code class="ruby">                user     system      total        real
  for:      0.960000   0.000000   0.960000 (  0.957966)
  times:    0.960000   0.000000   0.960000 (  0.960423)
  upto:     0.950000   0.000000   0.950000 (  0.954864)
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


203
204
205</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/benchmark.rb', line 203</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bm'>bm</span><span class='lparen'>(</span><span class='id identifier rubyid_label_width'>label_width</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_labels'>labels</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_blk'>blk</span><span class='rparen'>)</span> <span class='comment'># :yield: report
</span>  <span class='id identifier rubyid_benchmark'>benchmark</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="#CAPTION-constant" title="Benchmark::CAPTION (constant)">CAPTION</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_label_width'>label_width</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#FORMAT-constant" title="Benchmark::FORMAT (constant)">FORMAT</a></span></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_labels'>labels</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_blk'>blk</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="bmbm-class_method">
  
    .<strong>bmbm</strong>(width = 0)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Sometimes benchmark results are skewed because code executed
earlier encounters different garbage collection overheads than
that run later. #bmbm attempts to minimize this effect by running
the tests twice, the first time as a rehearsal in order to get the
runtime environment stable, the second time for
real. GC.start is executed before the start of each of
the real timings; the cost of this is not included in the
timings. In reality, though, there&#39;s only so much that #bmbm can
do, and the results are not guaranteed to be isolated from garbage
collection and other effects.</p>

<p>Because #bmbm takes two passes through the tests, it can
calculate the required label width.</p>

<pre class="code ruby"><code class="ruby">  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_array'>array</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='int'>1000000</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_rand'>rand</span> <span class='rbrace'>}</span>

  <span class='const'><span class='object_link'><a href="" title="Benchmark (module)">Benchmark</a></span></span><span class='period'>.</span><span class='id identifier rubyid_bmbm'>bmbm</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
    <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_array'>array</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_sort!'>sort!</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_array'>array</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>  <span class='rbrace'>}</span>
  <span class='kw'>end</span>
</code></pre>

<p>Generates:</p>

<pre class="code ruby"><code class="ruby">   Rehearsal -----------------------------------------
   sort!   1.440000   0.010000   1.450000 (  1.446833)
   sort    1.440000   0.000000   1.440000 (  1.448257)
   -------------------------------- total: 2.890000sec

               user     system      total        real
   sort!   1.460000   0.000000   1.460000 (  1.458065)
   sort    1.450000   0.000000   1.450000 (  1.455963)
</code></pre>

<h1>bmbm yields a Benchmark::Job object and returns an array of</h1>

<p>Benchmark::Tms objects.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/benchmark.rb', line 245</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bmbm'>bmbm</span><span class='lparen'>(</span><span class='id identifier rubyid_width'>width</span> <span class='op'>=</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='comment'># :yield: job
</span>  <span class='id identifier rubyid_job'>job</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Benchmark/Job.html" title="Benchmark::Job (class)">Job</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Benchmark/Job.html#initialize-instance_method" title="Benchmark::Job#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_width'>width</span><span class='rparen'>)</span>
  <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_job'>job</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_width'>width</span> <span class='op'>=</span> <span class='id identifier rubyid_job'>job</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span> <span class='op'>+</span> <span class='int'>1</span>
  <span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='const'>STDOUT</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span>
  <span class='const'>STDOUT</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='comment'># rehearsal
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Rehearsal </span><span class='tstring_end'>&#39;</span></span><span class='period'>.</span><span class='id identifier rubyid_ljust'>ljust</span><span class='lparen'>(</span><span class='id identifier rubyid_width'>width</span><span class='op'>+</span><span class='const'>CAPTION</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ets'>ets</span> <span class='op'>=</span> <span class='id identifier rubyid_job'>job</span><span class='period'>.</span><span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Benchmark/Tms.html" title="Benchmark::Tms (class)">Tms</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Benchmark/Tms.html#initialize-instance_method" title="Benchmark::Tms#initialize (method)">new</a></span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_sum'>sum</span><span class='comma'>,</span><span class='lparen'>(</span><span class='id identifier rubyid_label'>label</span><span class='comma'>,</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span><span class='op'>|</span>
    <span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_label'>label</span><span class='period'>.</span><span class='id identifier rubyid_ljust'>ljust</span><span class='lparen'>(</span><span class='id identifier rubyid_width'>width</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Benchmark (module)">Benchmark</a></span></span><span class='period'>.</span><span class='id identifier rubyid_measure'><span class='object_link'><a href="#measure-class_method" title="Benchmark.measure (method)">measure</a></span></span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span>
    <span class='id identifier rubyid_sum'>sum</span> <span class='op'>+</span> <span class='id identifier rubyid_res'>res</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>total: %tsec</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ets'>ets</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='id identifier rubyid_width'>width</span><span class='op'>+</span><span class='const'>CAPTION</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>+</span><span class='int'>2</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='comment'># take
</span>  <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='op'>*</span><span class='id identifier rubyid_width'>width</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="#CAPTION-constant" title="Benchmark::CAPTION (constant)">CAPTION</a></span></span>
  <span class='id identifier rubyid_job'>job</span><span class='period'>.</span><span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_label'>label</span><span class='comma'>,</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span>
    <span class='const'>GC</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>
    <span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_label'>label</span><span class='period'>.</span><span class='id identifier rubyid_ljust'>ljust</span><span class='lparen'>(</span><span class='id identifier rubyid_width'>width</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="" title="Benchmark (module)">Benchmark</a></span></span><span class='period'>.</span><span class='id identifier rubyid_measure'><span class='object_link'><a href="#measure-class_method" title="Benchmark.measure (method)">measure</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_label'>label</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_res'>res</span><span class='op'>|</span> <span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_res'>res</span> <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
<span class='kw'>ensure</span>
  <span class='const'>STDOUT</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='id identifier rubyid_sync'>sync</span> <span class='kw'>unless</span> <span class='id identifier rubyid_sync'>sync</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="measure-class_method">
  
    .<strong>measure</strong>(label = &quot;&quot;)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the time used to execute the given block as a
Benchmark::Tms object.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


286
287
288
289
290
291
292
293
294
295
296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/benchmark.rb', line 286</span>

<span class='kw'>def</span> <span class='id identifier rubyid_measure'>measure</span><span class='lparen'>(</span><span class='id identifier rubyid_label'>label</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># :yield:
</span>  <span class='id identifier rubyid_t0'>t0</span><span class='comma'>,</span> <span class='id identifier rubyid_r0'>r0</span> <span class='op'>=</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span><span class='comma'>,</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_clock_gettime'>clock_gettime</span><span class='lparen'>(</span><span class='const'>BENCHMARK_CLOCK</span><span class='rparen'>)</span>
  <span class='kw'>yield</span>
  <span class='id identifier rubyid_t1'>t1</span><span class='comma'>,</span> <span class='id identifier rubyid_r1'>r1</span> <span class='op'>=</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span><span class='comma'>,</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_clock_gettime'>clock_gettime</span><span class='lparen'>(</span><span class='const'>BENCHMARK_CLOCK</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="" title="Benchmark (module)">Benchmark</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Benchmark/Tms.html" title="Benchmark::Tms (class)">Tms</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Benchmark/Tms.html#initialize-instance_method" title="Benchmark::Tms#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_t1'>t1</span><span class='period'>.</span><span class='id identifier rubyid_utime'>utime</span>  <span class='op'>-</span> <span class='id identifier rubyid_t0'>t0</span><span class='period'>.</span><span class='id identifier rubyid_utime'>utime</span><span class='comma'>,</span>
                     <span class='id identifier rubyid_t1'>t1</span><span class='period'>.</span><span class='id identifier rubyid_stime'>stime</span>  <span class='op'>-</span> <span class='id identifier rubyid_t0'>t0</span><span class='period'>.</span><span class='id identifier rubyid_stime'>stime</span><span class='comma'>,</span>
                     <span class='id identifier rubyid_t1'>t1</span><span class='period'>.</span><span class='id identifier rubyid_cutime'>cutime</span> <span class='op'>-</span> <span class='id identifier rubyid_t0'>t0</span><span class='period'>.</span><span class='id identifier rubyid_cutime'>cutime</span><span class='comma'>,</span>
                     <span class='id identifier rubyid_t1'>t1</span><span class='period'>.</span><span class='id identifier rubyid_cstime'>cstime</span> <span class='op'>-</span> <span class='id identifier rubyid_t0'>t0</span><span class='period'>.</span><span class='id identifier rubyid_cstime'>cstime</span><span class='comma'>,</span>
                     <span class='id identifier rubyid_r1'>r1</span> <span class='op'>-</span> <span class='id identifier rubyid_r0'>r0</span><span class='comma'>,</span>
                     <span class='id identifier rubyid_label'>label</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="realtime-class_method">
  
    .<strong>realtime</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the elapsed real time used to execute the given block.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


301
302
303
304
305</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'opal/stdlib/benchmark.rb', line 301</span>

<span class='kw'>def</span> <span class='id identifier rubyid_realtime'>realtime</span> <span class='comment'># :yield:
</span>  <span class='id identifier rubyid_r0'>r0</span> <span class='op'>=</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_clock_gettime'>clock_gettime</span><span class='lparen'>(</span><span class='const'>BENCHMARK_CLOCK</span><span class='rparen'>)</span>
  <span class='kw'>yield</span>
  <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_clock_gettime'>clock_gettime</span><span class='lparen'>(</span><span class='const'>BENCHMARK_CLOCK</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_r0'>r0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on 05/12/19 by
  <!-- <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a> -->
  0.9.9 (ruby-2.6.2).
</div>

    </div>
  </body>
</html>