Opal.queue(function(Opal) {/* Generated by Opal 1.8.1 */
  var $module = Opal.module, $klass = Opal.klass, $to_ary = Opal.to_ary, $truthy = Opal.truthy, $send = Opal.send, $rb_plus = Opal.rb_plus, $def = Opal.def, self = Opal.top, $nesting = [], nil = Opal.nil, $$$ = Opal.$$$;

  Opal.add_stubs('require,handle,children,name_and_base,helper,nil?,body,stmt?,unshift,line,in_scope,name=,scope,in_closure,|,compile_body,await_encountered,await_encountered=,parent,+,nesting,private,cid,expr,stmt,returns,compiler,empty_line,add_temp,to_vars');
  
  self.$require("opal/nodes/scope");
  return (function($base, $parent_nesting) {
    var self = $module($base, 'Opal');

    var $nesting = [self].concat($parent_nesting);

    return (function($base, $parent_nesting) {
      var self = $module($base, 'Nodes');

      var $nesting = [self].concat($parent_nesting), $$ = Opal.$r($nesting);

      return (function($base, $super, $parent_nesting) {
        var self = $klass($base, $super, 'ModuleNode');

        var $nesting = [self].concat($parent_nesting), $$ = Opal.$r($nesting), $proto = self.$$prototype;

        $proto.define_nesting = $proto.define_relative_access = nil;
        
        self.$handle("module");
        self.$children("cid", "body");
        
        $def(self, '$compile', function $$compile() {
          var $a, $b, self = this, name = nil, base = nil, await_begin = nil, await_end = nil, async = nil;

          
          $b = self.$name_and_base(), $a = $to_ary($b), (name = ($a[0] == null ? nil : $a[0])), (base = ($a[1] == null ? nil : $a[1])), $b;
          self.$helper("module");
          if ($truthy(self.$body()['$nil?']())) {
            if ($truthy(self['$stmt?']())) {
              return self.$unshift("$module(", base, ", '" + (name) + "')")
            } else {
              return self.$unshift("($module(", base, ", '" + (name) + "'), nil)")
            }
          } else {
            
            self.$line("  var self = $module($base, '" + (name) + "');");
            $send(self, 'in_scope', [], function $$1(){var self = $$1.$$s == null ? this : $$1.$$s;

              
              self.$scope()['$name='](name);
              return $send(self, 'in_closure', [$$$($$('Closure'), 'MODULE')['$|']($$$($$('Closure'), 'JS_FUNCTION'))], function $$2(){var self = $$2.$$s == null ? this : $$2.$$s;

                return self.$compile_body()}, {$$s: self});}, {$$s: self});
            if ($truthy(self.$await_encountered())) {
              
              await_begin = "(await ";
              await_end = ")";
              async = "async ";
              self.$parent()['$await_encountered='](true);
            } else {
              $a = ["", "", ""], (await_begin = $a[0]), (await_end = $a[1]), (async = $a[2]), $a
            };
            self.$unshift("" + (await_begin) + "(" + (async) + "function($base" + (($truthy(self.define_nesting) ? (", $parent_nesting") : nil)) + ") {");
            return self.$line("})(", base, "" + (($truthy(self.define_nesting) ? ($rb_plus(", ", self.$scope().$nesting())) : nil)) + ")" + (await_end));
          };
        });
        self.$private();
        
        $def(self, '$name_and_base', function $$name_and_base() {
          var $a, $b, self = this, base = nil, name = nil;

          
          $b = self.$cid().$children(), $a = $to_ary($b), (base = ($a[0] == null ? nil : $a[0])), (name = ($a[1] == null ? nil : $a[1])), $b;
          if ($truthy(base['$nil?']())) {
            return [name, "" + (self.$scope().$nesting()) + "[0]"]
          } else {
            return [name, self.$expr(base)]
          };
        });
        return $def(self, '$compile_body', function $$compile_body() {
          var self = this, body_code = nil;

          
          body_code = self.$stmt(self.$compiler().$returns(self.$body()));
          self.$empty_line();
          if ($truthy(self.define_nesting)) {
            self.$add_temp("$nesting = [self].concat($parent_nesting)")
          };
          if ($truthy(self.define_relative_access)) {
            self.$add_temp("$$ = Opal.$r($nesting)")
          };
          self.$line(self.$scope().$to_vars());
          return self.$line(body_code);
        });
      })($nesting[0], $$('ScopeNode'), $nesting)
    })($nesting[0], $nesting)
  })($nesting[0], $nesting);
});
