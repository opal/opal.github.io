<!doctype html>
<html style="background-color: #f5f5f5; min-height: 100%;">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Opal 1.0</title>

  <link href="/stylesheets/application-356e0189.css" rel="stylesheet" />
  <link href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" />

  <script src="/application-44c8d9a5.js" onload="Opal.load('application');"></script>
</head>
<body class="blog blog_2019 blog_2019_05 blog_2019_05_12 blog_2019_05_12_opal-1-0 blog_2019_05_12_opal-1-0_index">
  <nav class='navbar navbar-default opal-nav' role='navigation'>
<div class='container'>
<div class='navbar-header'>
<a class='navbar-brand' href='/'>
<img height='22' src='https://secure.gravatar.com/avatar/88298620949a6534d403da2e356c9339?s=420&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-org-420.png' style='margin-top:-10%;' width='22'>
Opal
</a>
<button class='navbar-toggle' data-target='#opal-navbar' data-toggle='collapse' type='button'>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
</div>
<div class='navbar-collapse collapse' id='opal-navbar'>
<ul class='nav navbar-nav'>
<li>
<a href='/try'>
<i class='ion-ios-compose'></i>
Try
</a>
</li>
<li>
<a href='/blog'>
<i class='ion-ios-chatboxes'></i>
Blog
</a>
</li>
<li>
<a href='/docs'>
<i class='ion-ios-copy'></i>
Documentation
</a>
</li>
<li>
<a href='/libraries'>
<i class='ion-map'></i>
Libraries
</a>
</li>
<li>
<a href='https://github.com/opal/opal#readme'>
<i class='ion-social-github'></i>
GitHub
</a>
</li>
<li>
<a href='https://rubygems.org/gems/opal/versions/1.0.0' style='opacity: 0.5;'>
v1.0.0
</a>
</li>
</ul>
</div>
</div>
</nav>

  <script>$('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent().addClass('active')</script>

  <div class="container">
      <div class="container col-sm-8">
    <div class='blog-title'>
<h1>
<a href='/blog'>The Opal Blog</a>
</h1>
</div>

    <article class='blog-post'>
<header>
<h2 class='blog-post-title'>
<a href=''>
Opal 1.0
</a>
</h2>
<div class='blog-post-meta'>
Posted by Elia Schito on 2019-05-12
</div>
</header>
<div class='blog-post-body'>
<p>Dear Opalists of the world,&#x000A;<br>the time has come, <strong>1.0 has been released</strong>!</p>&#x000A;&#x000A;<p>This is, of course, a really important milestone, one that I&#39;ve been waited on for about seven years. I started advocating for releasing version 1.0 back in 2012 when Opal was still at version 0.3. After all, at that time I already had code in production, and according to <a href="https://semver.org">Semver</a> (which by then was still a new thing) that&#39;s one of the criteria for releasing 1.0:</p>&#x000A;&#x000A;<blockquote>&#x000A;<p>How do I know when to release 1.0.0?</p>&#x000A;&#x000A;<p>If your software is being used in production, it should probably already be 1.0.0. If you have a stable API on which users have come to depend, you should be 1.0.0. If you‚Äôre worrying a lot about backward compatibility, you should probably already be 1.0.0.</p>&#x000A;</blockquote>&#x000A;&#x000A;<p><em><a href="https://semver.org/#how-do-i-know-when-to-release-100">https://semver.org/#how-do-i-know-when-to-release-100</a></em></p>&#x000A;&#x000A;<p><strong>I was so proud and excited about this ability to use Ruby for frontend code!</strong> I was writing the logic for an in-page product filter and Ruby allowed me to solve the problem quickly, with its signature concise syntax, and leveraging the power of enumerable. That immensely reduced the lines of code I had to write and allowed me to concentrate on just the core of the problem.</p>&#x000A;&#x000A;<p>Many years have passed, and I&#39;m even more proud of the project that Opal has become, the maturity and the feature parity with MRI is astounding, the new features that are coming in version 1.0 are even more amazing, and the roadmap ahead <strong>makes Opal one of the best choices among compile-to-JS languages</strong>.</p>&#x000A;&#x000A;<hr>&#x000A;&#x000A;<p><em>Before diving into each new feature I&#39;d like to give immense credit for the MVP of this release, namely our good <a href="https://github.com/iliabylich">Ilia Bylich</a>! Without his unrelenting work and deep understanding of Ruby, we wouldn&#39;t be where we are. Thanks man!</em> üëèüëèüëè</p>&#x000A;&#x000A;<h2 id="notable-new-features">Notable New Features</h2>&#x000A;&#x000A;<div id="continue-reading"></div>&#x000A;&#x000A;<h3 id="native-prototype-chain-lookup-for-modules">Native Prototype Chain lookup for modules</h3>&#x000A;&#x000A;<p>Opal 1.0 comes with a complete overhaul of class and module hierarchy that now closely maps the original MRI design. In fact, the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">prototype chain</a> of any object will now include an entry for every Ruby ancestor, leaving to the JavaScript engine the caching and optimization of methods. This change also made possible the implementation of <code>Module.prepend</code> (see below) and a way simpler and correct management of <code>super</code> calls.</p>&#x000A;&#x000A;<h3 id="module-prepend">Module.prepend</h3>&#x000A;&#x000A;<p>One of the biggest and much-anticipated additions is certainly <code>Module.prepend</code>. The feature has received a number of implementation attempts through the year, but before the new <em>prototype</em> architecture now clean design was possible.</p>&#x000A;&#x000A;<p>To get the best results in terms of performance, the same rules apply for Opal and MRI: do all your include/prepend/extend as early as possible and never touch them again if you can.</p>&#x000A;&#x000A;<h3 id="faster-c-lexer">Faster C Lexer</h3>&#x000A;&#x000A;<p>As you may already know Opal now relies on the <a href="https://github.com/whitequark/parser">parser gem</a> to parse Ruby code (the same used by Rubocop). <em>Parser</em> is an incredibly complete piece of work and perfectly mimics the MRI parsers with <a href="https://github.com/whitequark/parser#known-issues">all its quirks</a>. That means that it&#39;s equally heavy on Ruby code, that made compiling Opal slower. After some benchmarking, we identified the bottleneck in the <a href="https://en.wikipedia.org/wiki/Lexical_analysis">lexing phase</a>.</p>&#x000A;&#x000A;<p>If you run Opal on MRI you can now add the <a href="https://github.com/opal/c_lexer"><code>c_lexer</code> gem</a> to your <code>Gemfile</code> and save whole seconds while compiling your code! üöÄ</p>&#x000A;&#x000A;<h3 id="usability-error-messages-source-maps">Usability: error messages &amp; source maps</h3>&#x000A;&#x000A;<p>The developer experience when working with Opal is now even better. Wasn&#39;t enough to allow you to use Ruby as the UI to frontend-code, it now features:</p>&#x000A;&#x000A;<ul>&#x000A;<li>full filenames in compiled code (previously only the basename was used)</li>&#x000A;<li>stack traces that point to the error in the Opal code (instead of the location of the error inside the parser/compiler)</li>&#x000A;<li>better use of displayName to clearly between Ruby and JavaScript  in stack-traces within the browser</li>&#x000A;<li>inline all-in-one source maps comment with improved precision, no more additional requests with complicated server setups and off-by-one line errors</li>&#x000A;</ul>&#x000A;&#x000A;<p>We&#39;re loving it and we know you&#39;re gonna love it too! ‚ù§Ô∏è</p>&#x000A;&#x000A;<h3 id="missing-requires-management">Missing requires management</h3>&#x000A;&#x000A;<p>It&#39;s now possible to <em>ignore</em> missing/dynamic requires during compile-time and only raise errors at runtime, just like MRI would do.</p>&#x000A;&#x000A;<h3 id="targeting-ruby-2-5">Targeting Ruby 2.5</h3>&#x000A;&#x000A;<p>A bunch of features have been added that come right out of Ruby 2.4 and 2.5, those include:</p>&#x000A;&#x000A;<ul>&#x000A;<li><code>Array#prepend</code></li>&#x000A;<li><code>Array#append</code></li>&#x000A;<li><code>Array#max</code></li>&#x000A;<li><code>Array#min</code></li>&#x000A;<li><code>Complex#finite?</code></li>&#x000A;<li><code>Complex#infinite?</code></li>&#x000A;<li><code>Complex#infinite?</code></li>&#x000A;<li><code>Date#to_time</code></li>&#x000A;<li><code>Date#next_year</code></li>&#x000A;<li><code>Date#prev_year</code></li>&#x000A;<li><code>Hash#slice</code></li>&#x000A;<li><code>Hash#transform_keys</code></li>&#x000A;<li><code>Hash#transform_keys!</code></li>&#x000A;<li><code>Numeric#finite?</code></li>&#x000A;<li><code>Numeric#infinite?</code></li>&#x000A;<li><code>Numeric#infinite?</code></li>&#x000A;<li><code>Integer#allbits?</code></li>&#x000A;<li><code>Integer#anybits?</code></li>&#x000A;<li><code>Integer#digits</code></li>&#x000A;<li><code>Integer#nobits?</code></li>&#x000A;<li><code>Integer#pow</code></li>&#x000A;<li><code>Integer#remainder</code></li>&#x000A;<li><code>Integer.sqrt</code></li>&#x000A;<li><code>Random.urandom</code></li>&#x000A;<li><code>String#delete_prefix</code></li>&#x000A;<li><code>String#delete_suffix</code></li>&#x000A;<li><code>String#casecmp?</code></li>&#x000A;<li><code>Kernel#yield_self</code></li>&#x000A;<li><code>String#unpack1</code></li>&#x000A;<li><code>String#to_r</code></li>&#x000A;<li><code>String#to_c</code></li>&#x000A;<li><code>String#match?</code></li>&#x000A;<li><code>String#unicode_normalize</code> returns self</li>&#x000A;<li><code>String#unicode_normalized?</code> returns true</li>&#x000A;</ul>&#x000A;&#x000A;<h3 id="random-generator-pack-unpack-nodejs-fs-support">Random generator, Pack/Unpack, Nodejs FS support</h3>&#x000A;&#x000A;<p>A ton of other stuff has been added and we encourage you to have a peek at the <a href="https://github.com/opal/opal/compare/v0.11.4...v1.0.0">commit list</a>.</p>&#x000A;&#x000A;<p>Opal now implements a <a href="https://en.wikipedia.org/wiki/Mersenne_Twister">Mersenne Twister pseudo-random number generator</a>, that&#39;s the same algorithm employed by MRI.</p>&#x000A;&#x000A;<p>An initial implementation of <code>Array#pack</code> and <code>String#unpack</code> has been added, if you don&#39;t know what those are you can <a href="https://blog.bigbinary.com/2011/07/20/ruby-pack-unpack.html">learn about them here</a>.</p>&#x000A;&#x000A;<p>Thanks to the contributions of our good <a href="https://github.com/Mogztter">@Mogztter</a> of <a href="https://github.com/asciidoctor/asciidoctor.js">Asciidoctor.js</a> fame we got a bunch of additions to the Node.js support libraries that will make your life much easier if you plan to use the <code>File</code> and <code>Dir</code> classes with Opal from Node.js.</p>&#x000A;&#x000A;<h2 id="roadmap">Roadmap</h2>&#x000A;&#x000A;<p>Finally let&#39;s spend a word on the future, laying out the roadmap for the next releases. Anyone is encouraged to weight in on our <a href="https://gitter.im/opal/opal">gitter chatroom</a> and give feedback about this, but I feel pretty confident that we&#39;re setting the priorities right. üòé</p>&#x000A;&#x000A;<h3 id="strict-mode-webpack-v1-1">Strict-mode &amp; Webpack (v1.1)</h3>&#x000A;&#x000A;<p>Webpacker is going to be the default in Rails 6 and we&#39;re committed to making Webpack support for Opal a first-class citizen. Webpack also requires loaded modules to comply with <em>strict-mode</em>. We&#39;re already moving in that direction, thanks to the patient work of @janbiederman, and I&#39;m pleased to tell that the early results are very promising and showing already noticeable performance improvements for most benchmarks! üöÄ</p>&#x000A;&#x000A;<h3 id="dead-code-elimination-v1-2">Dead Code Elimination (v1.2)</h3>&#x000A;&#x000A;<p>This is another big one, Dead Code Elimination is a technique used to remove from the compiled bundle all the code that it&#39;s never going to be used. The more we implement methods from Ruby&#39;s <em>corelib</em> and <em>stdlib</em> the more the compiled bundle will grow. We know, of course, that the resulting application code will often be much smaller, but we also need to acknowledge the fact that is likely that the vast majority of the code will never be run.</p>&#x000A;&#x000A;<p>Opal is already able to track <em>methods</em> and <em>constants</em> usage while compiling a file, and the basic idea is to use that to identify methods, classes, and modules that will never be used once. If we can pull this off the compiled bundle size will shrink dramatically contemporarily improving boot time! üóú</p>&#x000A;&#x000A;<h3 id="mutable-strings-v1-3">Mutable Strings (v1.3)</h3>&#x000A;&#x000A;<p>Opal maps Ruby&#39;s String class directly to its JavaScript counterpart. That means that, in Opal, strings are immutable and we need to update or patch gems before using them on a JavaScript engine. Adding mutable strings (while still using frozen ones by default) will be of great help for compatibility, and for those situations where it&#39;s much easier to operate on strings using <em>bang!</em> methods. üí•</p>&#x000A;&#x000A;<h2 id="ecosystem">Ecosystem</h2>&#x000A;&#x000A;<p>We&#39;ll release updated versions of all the gems in the ecosystem in the following weeks updating their Gem spec requirements to include Opal 1.0 and patches as needed. That includes <code>opal-rails</code>, <code>opal-sprockets</code>, <code>opal-jquery</code>, <code>opal-rspec</code>, <code>opal-haml</code>, etc.</p>&#x000A;&#x000A;<p>If you encounter any issue while upgrading or using your favorite gems with Opal 1.0 please let us know asking in the <a href="http://gitter.im/opal/opal">gitter channel</a>, with the <a href="https://stackoverflow.com/questions/ask?tags=opalrb">#opalrb tag on StackOverflow</a>, or (opening an issue on GitHub)[https://github.com/opal/opal/issues].</p>&#x000A;&#x000A;<h2 id="conclusion">Conclusion</h2>&#x000A;&#x000A;<p>Opal is doing better than ever and it&#39;s a great time to start building awesome things with it, the kind that we usually build in the Ruby community, full of creativity, with blithe disregard of current programming dogma and open to everyone.</p>&#x000A;&#x000A;<p>(Happy Mother&#39;s Day! ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è)</p>&#x000A;&#x000A;<p>The Change Log: https://github.com/opal/opal/releases/tag/v1.0.0&#x000A;The full list of commits: https://github.com/opal/opal/compare/v0.11.4...v1.0.0 <a href="https://github.com/opal/opal/compare/v0.11.4...v1.0.0.diff">raw diff</a>&#x000A;The main website: https://opalrb.com&#x000A;Documentation: http://opalrb.com/docs/</p>&#x000A;</div>
</article>

  </div>

  </div>

  <!-- GOOGLE ANALYTICS -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35688734-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<footer>
  <a href="/license"><i class="ion-unlocked"></i> License</a> ¬∑
  <a href="https://github.com/opal/opal/graphs/contributors"><i class="ion-fork-repo"></i> Contributors</a>
</footer>


  <script>
    $('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent('li').addClass('active')
  </script>
</body>
</html>
