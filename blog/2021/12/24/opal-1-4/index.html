<!doctype html>
<html style="background-color: #f5f5f5; min-height: 100%;">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Opal 1.4: Ruby 3.1, performance, and bundle size</title>

  <link href="/assets/application-915b7e3cafe6e192dee011fa09837b2af85b7e1de3dbb52fd1413d46dd2dca0e.css" rel="stylesheet" />
  <link href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" />

  <script src="/assets/application-74994a7410818947c294a5f44b8f7916d5e1c773e93a5a2c83db9c06d516fd80.js" onload="Opal.loaded(typeof(OpalLoaded) === &quot;undefined&quot; ? [] : OpalLoaded);
Opal.require(&quot;application&quot;);;console.log('loaded application')"></script>

  <!-- Algolia -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>
<body class="blog blog_2021 blog_2021_12 blog_2021_12_24 blog_2021_12_24_opal-1-4 blog_2021_12_24_opal-1-4_index">
  <nav class='navbar navbar-default opal-nav' role='navigation'>
<div class='container'>
<div class='navbar-header'>
<a class='navbar-brand' href='/'>
<img height='22' src='https://secure.gravatar.com/avatar/88298620949a6534d403da2e356c9339?s=420&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-org-420.png' style='margin-top:-10%;' width='22'>
Opal
</a>
<button class='navbar-toggle' data-target='#opal-navbar' data-toggle='collapse' type='button'>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
</div>
<div class='navbar-collapse collapse' id='opal-navbar'>
<ul class='nav navbar-nav'>
<li>
<a href='/try'>
<i class='ion-ios-compose'></i>
Try
</a>
</li>
<li>
<a href='/blog'>
<i class='ion-ios-chatboxes'></i>
Blog
</a>
</li>
<li>
<a href='/docs'>
<i class='ion-ios-copy'></i>
Documentation
</a>
</li>
<li>
<a href='/libraries'>
<i class='ion-map'></i>
Libraries
</a>
</li>
<li>
<a href='https://github.com/opal/opal#readme'>
<i class='ion-social-github'></i>
GitHub
</a>
</li>
<li>
<a href='https://rubygems.org/gems/opal/versions/1.8.1' style='opacity: 0.5;'>
v1.8.1
</a>
</li>
</ul>
<ul class='nav navbar-right'>
<li class='search-bar'>
<form id='search-form'>
<input placeholder='Search docs &amp; guides' type='search'>
<button title='Clear the search query.' type='reset'>
&times;
</button>
</form>
</li>
</ul>
</div>
</div>
</nav>


  <div class="container">
      <div class="container col-sm-8">
    <div class='blog-title'>
<h1>
<a href='/blog'>The Opal Blog</a>
</h1>
</div>

    <article class='blog-post'>
<header>
<h2 class='blog-post-title'>
<a href=''>
Opal 1.4: Ruby 3.1, performance, and bundle size
</a>
</h2>
<div class='blog-post-meta'>
Posted by hmdne
<br>
December 24, 2021
</div>
</header>
<div class='blog-post-body'>
<p>We are proud to announce an immediate availability of Opal 1.4!</p>&#x000A;&#x000A;<p>Opal is a Ruby to JavaScript (ES5) compiler allowing you to write frontend code in pure Ruby (and a lot more!).</p>&#x000A;&#x000A;<p>This version of Opal is about compatibility with Ruby 3.1 and lots of internal improvement around performance, code size, and readability of the generated code. Opal 1.3 was released just about 2 months ago, but we really wanted to get 3.1-level compatibility out around the time Ruby 3.1 is released this Christmas.</p>&#x000A;&#x000A;<p><em>As always, you don&#39;t need to run Opal with Ruby 3.1 to benefit from the 3.1-level features, Ruby 2.6 will do just fine :)</em></p>&#x000A;&#x000A;<div id="continue-reading"></div>&#x000A;&#x000A;<h2 id="new-ruby-3-1-features">New Ruby 3.1 features</h2>&#x000A;&#x000A;<p><code>Class#subclasses</code>, <code>Class#descendants</code>, syntax like <code>h = {a:}</code> is all supported, along with a lot of other Ruby 3.1 features. You can take a look at <a href="https://github.com/opal/opal/releases/tag/v1.4.0">our changelog</a> or Ruby 3.1 release notes to read about all the new features we have. Big thanks to the people working on <a href="https://github.com/whitequark/parser">whitequark/parser</a> - their hard work made this possible - it didn&#39;t require from us any effort to support the new syntax features!</p>&#x000A;&#x000A;<p>We also added some features from older versions of Ruby that we missed. For example: <code>Kernel#local_variables</code> and <code>Enumerator::ArithmeticSequence</code>.</p>&#x000A;&#x000A;<h2 id="generated-size-optimization">Generated size optimization</h2>&#x000A;&#x000A;<p>Despite the fact, that we added a lot of features, Opal 1.4 is 20% smaller than Opal 1.3 (minified) and just a little bit larger than Opal 1.0.0. Your web applications should be about 10% - 20% smaller uncompressed, which should directly translate to better performance and load times. Please take a look at our <a href="https://opalrb.com/blog/2021/11/24/optimizing-opal-output-for-size/">blog post</a> if you are interested in how we achieved this. In addition to that the produced code is way more readable than before.</p>&#x000A;&#x000A;<p>Jan Biedermann who develops <a href="https://github.com/isomorfeus">isomorfeus</a>, a Preact-based framework using Opal reported the following numbers:</p>&#x000A;<div class="highlight"><pre class="highlight plaintext"><code>                                 1.3.2  1.4.0.alpha1&#x000A;Max asset sizes: minified:       600kb  502kb&#x000A;gzip:                            150kb  132kb&#x000A;isomorfeus-redux require time:    19ms   19ms&#x000A;isomorfeus-preact require time:   52ms   46ms&#x000A;isomorfeus-preact start_app! time: 6ms    7ms&#x000A;application load_time:            78ms   73ms&#x000A;10000 Native DIV Elements took:   10ms    8ms&#x000A;10000 DIV Elements (S p) took:    78ms   77ms&#x000A;10000 DIV Elements (S b) took:    95ms   78ms&#x000A;10000 Native Components took:    115ms   95ms&#x000A;10000 Function Components took:  203ms  192ms&#x000A;10000 Preact Components took:    181ms  160ms&#x000A;10000 Lucid Funcs took:          318ms  306ms&#x000A;10000 Lucid Components took:     367ms  339ms&#x000A;10000 Styled Lucid Comp took:    469ms  433ms&#x000A;10000 Themed and Styled LC took: 505ms  473ms&#x000A;</code></pre></div>&#x000A;<h2 id="promisev2-is-now-declared-stable"><code>PromiseV2</code> is now declared stable!</h2>&#x000A;&#x000A;<p>From my personal experience, it&#39;s very simple to replace the old <code>Promise</code> with the new <code>PromiseV2</code> and I didn&#39;t have any issues. While in Opal 1.2 and 1.3 it was a developer preview, we now declare it as stable and a recommended way to do <code>Promise</code>s.</p>&#x000A;&#x000A;<h2 id="conclusion">Conclusion</h2>&#x000A;&#x000A;<p>Merry Christmas everyone and we hope that Opal 1.4 will be a present you will all enjoy!</p>&#x000A;&#x000A;<hr>&#x000A;&#x000A;<h3 id="resources">Resources</h3>&#x000A;&#x000A;<ul>&#x000A;<li><a href="https://github.com/opal/opal/releases/tag/v1.4.0">Changelog for v1.4.0</a></li>&#x000A;<li><a href="https://github.com/opal/opal/compare/v1.3.2...v1.4.0">List of commits</a> / <a href="https://github.com/opal/opal/compare/v1.3.2...v1.4.0.diff">raw diff</a></li>&#x000A;<li><a href="https://opalrb.com">Updated website</a></li>&#x000A;<li><a href="http://opalrb.com/docs/">Documentation</a></li>&#x000A;</ul>&#x000A;</div>
</article>

  </div>

  </div>

  <footer>
  <a href="/license"><i class="ion-unlocked"></i> License</a> Â·
  <a href="https://github.com/opal/opal/graphs/contributors"><i class="ion-fork-repo"></i> Contributors</a>
</footer>


  <script>
    document.querySelector(`a[href="${location.pathname.replace(/\/$/,'')}"]`)?.parentElement.classList.add("active")
  </script>

  <!-- Algolia -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript">
    docsearch({
      apiKey: 'cf08db1eca77cb92ca34e24a86430bcb',
      indexName: 'opalrb',
      inputSelector: '#search-form input[type="search"]',
      debug: false // Set debug to true if you want to inspect the dropdown
    });
  </script>
</body>
</html>
