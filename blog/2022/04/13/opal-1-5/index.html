<!doctype html>
<html style="background-color: #f5f5f5; min-height: 100%;">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Opal 1.5: binding.irb in a web browser</title>

  <link href="/assets/application-915b7e3cafe6e192dee011fa09837b2af85b7e1de3dbb52fd1413d46dd2dca0e.css" rel="stylesheet" />
  <link href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" />

  <script src="/assets/application-596f523b41cd0c1b75b8066512c4c9b592e85ce699428a05db4d6ac425c2b09f.js" onload="Opal.loaded(typeof(OpalLoaded) === &quot;undefined&quot; ? [] : OpalLoaded);
Opal.require(&quot;application&quot;);;console.log('loaded application')"></script>

  <!-- Algolia -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>
<body class="blog blog_2022 blog_2022_04 blog_2022_04_13 blog_2022_04_13_opal-1-5 blog_2022_04_13_opal-1-5_index">
  <nav class='navbar navbar-default opal-nav' role='navigation'>
<div class='container'>
<div class='navbar-header'>
<a class='navbar-brand' href='/'>
<img height='22' src='https://secure.gravatar.com/avatar/88298620949a6534d403da2e356c9339?s=420&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-org-420.png' style='margin-top:-10%;' width='22'>
Opal
</a>
<button class='navbar-toggle' data-target='#opal-navbar' data-toggle='collapse' type='button'>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
</div>
<div class='navbar-collapse collapse' id='opal-navbar'>
<ul class='nav navbar-nav'>
<li>
<a href='/try'>
<i class='ion-ios-compose'></i>
Try
</a>
</li>
<li>
<a href='/blog'>
<i class='ion-ios-chatboxes'></i>
Blog
</a>
</li>
<li>
<a href='/docs'>
<i class='ion-ios-copy'></i>
Documentation
</a>
</li>
<li>
<a href='/libraries'>
<i class='ion-map'></i>
Libraries
</a>
</li>
<li>
<a href='https://github.com/opal/opal#readme'>
<i class='ion-social-github'></i>
GitHub
</a>
</li>
<li>
<a href='https://rubygems.org/gems/opal/versions/1.8.2' style='opacity: 0.5;'>
v1.8.2
</a>
</li>
</ul>
<ul class='nav navbar-right'>
<li class='search-bar'>
<form id='search-form'>
<input placeholder='Search docs &amp; guides' type='search'>
<button title='Clear the search query.' type='reset'>
&times;
</button>
</form>
</li>
</ul>
</div>
</div>
</nav>


  <div class="container">
      <div class="container col-sm-8">
    <div class='blog-title'>
<h1>
<a href='/blog'>The Opal Blog</a>
</h1>
</div>

    <article class='blog-post'>
<header>
<h2 class='blog-post-title'>
<a href=''>
Opal 1.5: binding.irb in a web browser
</a>
</h2>
<div class='blog-post-meta'>
Posted by hmdne, elia
<br>
April 13, 2022
</div>
</header>
<div class='blog-post-body'>
<p>We are happy to announce that Opal 1.5 is out!</p>&#x000A;&#x000A;<p>Opal is a Ruby (3.1) to JavaScript (ES5) compiler allowing you to write frontend code in pure Ruby and have it translated to clean and efficient JavaScript. It also includes a highly compatible core library that includes all the methods you&#39;ve come to love.</p>&#x000A;&#x000A;<p>This release is mostly focused on performance improvements. In fact, in our tests, we got a 2x performance bump for the Opal Ruby compiler running in V8! As always, we have some new features (<code>binding.irb</code>), some compatibility improvements and a bunch of bugfixes.</p>&#x000A;&#x000A;<p>Try it now on <a href="https://opalrb.com/try">opalrb.com/try</a>.</p>&#x000A;&#x000A;<div id="continue-reading"></div>&#x000A;&#x000A;<h2 id="enter-binding-irb">Enter <code>binding.irb</code></h2>&#x000A;&#x000A;<p>This release was focused on getting <code>binding.irb</code> work in Opal. We decided to include this feature by default, so you can start debugging issues without needing to do anything. This barely has a performance or load time impact, since most of the logic is loaded dynamically from Opal CDN only when needed (including the Ruby parser and Opal compiler). In fact, because of the other improvements in this release, your bundle size may be even smaller than in Opal 1.4.</p>&#x000A;&#x000A;<p>Under the hood, in browser we use a <code>prompt</code> JavaScript function (which is what <code>IO#gets</code> does) and we reuse a lot of the code that was written for <code>opal-repl</code>. So in general, we didn&#39;t port <code>irb</code> per se, but rather a tool that is more in line with what Opal developers need (for example it has some facilities to handle the native JavaScript values). Sadly, while <code>irb</code> has recently progressed very much and due to the limited interface, we don&#39;t support all the features you may think of, but a well known <code>ls</code> function is supported!</p>&#x000A;&#x000A;<p>In addition, if you are using your browser debugger (for example in a breakpoint), you can always run <code>Opal.irb(s =&gt; eval(s))</code> in your Web Inspector to launch a Ruby console. The passed <code>eval</code> function automatically creates a view where you can reference things like <code>self</code>, local variables, instance variables, etc.</p>&#x000A;&#x000A;<p>It is very simple to take a sneak peek at this feature. All you need to do is to install Opal with your <code>gem install opal</code> and run the following command:</p>&#x000A;<div class="highlight"><pre class="highlight shell"><code>opal <span class="nt">-Rserver</span> <span class="nt">-e</span> <span class="s1">'def hello; foo = 5; bar = "a"; binding.irb; end; hello'</span>&#x000A;</code></pre></div>&#x000A;<p>This will launch a server on http://localhost:3000/. When you open a browser, it will run a function <code>hello</code> that will launch an <code>irb</code> session.</p>&#x000A;&#x000A;<p>This automatic load doesn&#39;t work outside of the browser, so to run in Node, you need to explicitly require <code>opal-parser</code> and <code>opal-replutils</code>. To test this feature in Node, you will obviously need to install opal (and Node!) and run the following command:</p>&#x000A;<div class="highlight"><pre class="highlight shell"><code>opal <span class="nt">-ropal</span>/platform <span class="nt">-e</span> <span class="s1">'require "opal-replutils"; require "opal-parser"; def hello; foo = 5; bar = "a"; binding.irb; end; hello'</span>&#x000A;</code></pre></div>&#x000A;<p>Of course if your intention is to just run an interactive Opal console, you can simply run <code>opal-repl</code> which has been supported for a couple of releases already.</p>&#x000A;&#x000A;<p>We hope this feature will bring the frontend and backend development even closer than it already was with Opal!</p>&#x000A;&#x000A;<h2 id="performance">Performance</h2>&#x000A;&#x000A;<p>As for the last few releases we kept hitting hard on performance. This time argument coercion and <code>Array#[]=</code> got faster, along with writer methods (e.g. <code>def foo=(v) @foo = v end</code>) that had a 4% gain. Whenever possible we also now compile <code>case/when</code> statements to the JavaScript native <code>switch() {case: …}</code> instead of using a list of <code>if</code> / <code>else if</code> whenever possible.</p>&#x000A;&#x000A;<h2 id="date-time-and-timezone">Date, Time, and Timezone</h2>&#x000A;&#x000A;<p>With Opal 1.5 you can finally enjoy basic support for timezones. The <code>DateTime</code> class was also added for better compatibility with MRI, along with a bunch of refactoring to all the time classes.</p>&#x000A;&#x000A;<h2 id="conclusion">Conclusion</h2>&#x000A;&#x000A;<p>As always this version brings a lot of other bug fixes and small improvements, please have a look at the full changelog. If you want to know more, have questions, or want to start contributing, please <a href="https://slack.opalrb.com">join the Slack channel</a> and ask around, we&#39;re always happy to welcome new people to the community!</p>&#x000A;&#x000A;<p>Happy Easter to everyone!</p>&#x000A;&#x000A;<hr>&#x000A;&#x000A;<h3 id="resources">Resources</h3>&#x000A;&#x000A;<ul>&#x000A;<li><a href="https://github.com/opal/opal/releases/tag/v1.5.0">Changelog for v1.5.0</a></li>&#x000A;<li><a href="https://github.com/opal/opal/compare/v1.4.1...v1.5.0">List of commits</a> / <a href="https://github.com/opal/opal/compare/v1.4.1...v1.5.0.diff">raw diff</a></li>&#x000A;<li><a href="https://opalrb.com">Updated website</a></li>&#x000A;<li><a href="http://opalrb.com/docs/">Documentation</a></li>&#x000A;</ul>&#x000A;</div>
</article>

  </div>

  </div>

  <footer>
  <a href="/license"><i class="ion-unlocked"></i> License</a> ·
  <a href="https://github.com/opal/opal/graphs/contributors"><i class="ion-fork-repo"></i> Contributors</a>
</footer>


  <script>
    document.querySelector(`a[href="${location.pathname.replace(/\/$/,'')}"]`)?.parentElement.classList.add("active")
  </script>

  <!-- Algolia -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript">
    docsearch({
      apiKey: 'cf08db1eca77cb92ca34e24a86430bcb',
      indexName: 'opalrb',
      inputSelector: '#search-form input[type="search"]',
      debug: false // Set debug to true if you want to inspect the dropdown
    });
  </script>
</body>
</html>
